@{
    var db = Database.Open("WebPagesMovies");
    var selectCommand = "Select * From Movies";
    var searchTerm = "";

    if(!Request.QueryString["searchGenre"].IsEmpty())
    {
        selectCommand = "Select * From Movies Where Genre=@0";
        searchTerm = Request.QueryString["searchGenre"];
    }
    else if(!Request.QueryString["searchTitle"].IsEmpty())
    {
        selectCommand = "Select * From Movies Where Title Like @0";
        searchTerm = "%" + Request.QueryString["searchTitle"] + "%";
    }

    var selectData = db.Query(selectCommand, searchTerm);
    var grid = new WebGrid(source: selectData, defaultSort: "Genre", rowsPerPage: 3);
}

<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Movies</title>
        <style type="text/css">
            .grid { margin: 4px; border-collapse: collapse; width: 600px; }
            .grid th, .grid td { border: 1px solid #C0C0C0; padding: 5px; }
            .head { background-color: #E8E8E8; font-weight: bold; color: #FFF; }
            .alt { background-color: #E8E8E8; color: #000; }
        </style>
    </head>
    <body>
        <h1>Movies @searchTerm</h1>
        <form method="get">
            <div>
                <label for="searchGenre">Genre to look for</label>
                <input type="text" name="searchGenre" value="@Request.QueryString["searchGenre"]" />
                <input type="Submit" value="Search Genre" /> <br/>
            </div>
            <div>
                <label for="searchTitle">Movie title contains following</label>
                <input type="text" name="searchTitle" value="@Request.QueryString["searchTitle"]" />
                <input type="Submit" value="Search Title" /> <br/>
            </div>
        </form>
        <div>
            @grid.GetHtml(
                tableStyle: "grid",
                headerStyle: "head",
                alternatingRowStyle: "alt",
                columns: grid.Columns(grid.Column("Title"), grid.Column("Genre"), grid.Column("Year")) 
            );
        </div>
        <p>
            <a href="~/AddMovie">Add a movie</a>
        </p>
    </body>
</html>
